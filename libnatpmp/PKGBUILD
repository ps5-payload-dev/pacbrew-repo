pkgname=ps5-payload-libnatpmp
pkgver=20230423
pkgrel=1
pkgdesc='A portable and fully compliant implementation of the NAT-PMP protocol'
arch=('any')
url='http://miniupnp.free.fr/libnatpmp.html'
license=(BSD)
options=(!strip libtool staticlibs)
source=("https://miniupnp.tuxfamily.org/files/libnatpmp-$pkgver.tar.gz")
sha256sums=('0684ed2c8406437e7519a1bd20ea83780db871b3a3a5d752311ba3e889dbfc70')

groups=('ps5-payload-dev')
makedepends=('ps5-payload-sdk')

prepare() {
    if [ -z "${PS5_PAYLOAD_SDK}" ]; then
	export PS5_PAYLOAD_SDK=/opt/ps5-payload-sdk
    fi
}

build() {
    source "${PS5_PAYLOAD_SDK}/toolchain/prospero.sh"
    cd libnatpmp-$pkgver
    ${MAKE} CC=${CC} libnatpmp.a
}

package() {
    source "${PS5_PAYLOAD_SDK}/toolchain/prospero.sh"
    cd libnatpmp-$pkgver

    install -Dm 644 natpmp.h -t "${pkgdir}/${DESTDIR}/${PREFIX}/include"
    install -Dm 644 natpmp_declspec.h -t "${pkgdir}/${DESTDIR}/${PREFIX}/include"
    install -Dm 644 libnatpmp.a -t "${pkgdir}/${DESTDIR}/${PREFIX}/lib"
}
